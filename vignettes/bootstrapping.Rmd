---
title: "Bootstrapping"
author: Cameron Roach
output: 
  html_notebook: 
    number_sections: yes
    toc: yes
    toc_float:
      collapsed: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)

rm(list=ls())

require(dplyr)
require(tidyr)
require(readxl)
require(lubridate)
require(ggplot2)
require(plotly)
require(DT)
require(caret)
require(myhelpr)
require(doMC)

registerDoMC(cores = 3)

source("../R/loadData.R")
source("../R/clean-smd-data.R")

load_zones_ma <- c("SEMASS", "WCMASS", "NEMASSBOST")
load_zones <- c("ME", "NH", "VT", "CT", "RI", load_zones_ma)

smd <- load_smd_data(load_zones, root_dir = "./..")
smd <- clean_smd_data(smd, root_dir = "./..")

iZ <- "VT"

smd <- filter(smd, Zone == iZ)
```


# Bootstrapping methodology

Similar to the double seasonal block bootstrap by Hyndman and Shu (2010).

## Psuedo-code

The bootstrapping method will return date and time values so that any variable can be looked up later on. This will ensure any bootstrapped weather data will retain correlations between zones and with residuals.

The parameters `delta1` and `delta2` set the amount of variation in the date chosen and the length of 

**NOTE: Be careful when sampling at end of year. Make sure we move from one year to the next and don't accidentally sample from beginning => discontinuity!**

```{r eval=FALSE}
GET days in season
SET delta1, delta2
SET number of simulated seasons

FOR number of simulated seasons
  WHILE simulated season not complete
    FOR current day of simulated season
      GET random historical year
      GET day near current day => current day + U(-delta1, delta1)
      GET the next 14 + U(-delta2, delta2) dates starting from this day
      APPEND these historical dates to current simulated season
      SET index to next day of simulated season without data.

GET weather data for dates and times in bootstrapped date-time data
GET residual data for dates and times in bootstrapped date-time data
```


# Weather bootstrapping

Correlogram for dry bulb temperature and dew point temperature shown below. Serial correlations for 720 lags (30 days) have been calculated.

```{r weather_correlation}
with(smd, acf(DryBulb, lag.max = 30*24))

with(smd, acf(DewPnt, lag.max = 30*24))
```


```{r weather_bootstrapping}

```


 # Residual boostrapping
 
 
 
 ```{r residual_bootstrapping}

```
